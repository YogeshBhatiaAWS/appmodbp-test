"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.BackstageAddOn = void 0;
const helm_addon_1 = require("../helm-addon");
const utils_1 = require("../../utils");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const HTTPS = "https://";
/**
 * Default props to be used when creating the Helm chart
 */
const defaultProps = {
    name: "blueprints-backstage-addon",
    namespace: "backstage",
    chart: "backstage",
    version: "0.17.0",
    release: "backstage",
    repository: "https://backstage.github.io/charts",
    imageTag: "latest",
    values: {}
};
/**
 * Main class to instantiate the Helm chart
 */
class BackstageAddOn extends helm_addon_1.HelmAddOn {
    constructor(props) {
        super({ ...defaultProps, ...props });
        this.options = this.props;
    }
    deploy(clusterInfo) {
        let values = this.populateValues(clusterInfo, this.options);
        const chart = this.addHelmChart(clusterInfo, values);
        new aws_cdk_lib_1.CfnOutput(clusterInfo.cluster.stack, 'Backstage base URL', {
            value: HTTPS + this.options.subdomain,
            description: "Backstage base URL",
            exportName: "BackstageBaseUrl",
        });
        return Promise.resolve(chart);
    }
    /**
    * populateValues populates the appropriate values used to customize the Helm chart
    * @param helmOptions User provided values to customize the chart
    */
    populateValues(clusterInfo, helmOptions) {
        var _a, _b;
        const values = (_a = helmOptions.values) !== null && _a !== void 0 ? _a : {};
        const annotations = {
            "alb.ingress.kubernetes.io/scheme": "internet-facing",
            "alb.ingress.kubernetes.io/target-type": "ip",
            "alb.ingress.kubernetes.io/certificate-arn": (_b = clusterInfo.getResource(helmOptions.certificateResourceName)) === null || _b === void 0 ? void 0 : _b.certificateArn
        };
        const databaseInstance = clusterInfo.getRequiredResource(helmOptions.databaseResourceName);
        if (databaseInstance === undefined) {
            throw new Error("Database instance not found");
        }
        const databaseChartValues = {
            "client": "pg",
            "connection": {
                "host": databaseInstance.dbInstanceEndpointAddress,
                "port": databaseInstance.dbInstanceEndpointPort,
                "user": "${POSTGRES_USER}",
                "password": "${POSTGRES_PASSWORD}"
            }
        };
        (0, utils_1.setPath)(values, "ingress.enabled", true);
        (0, utils_1.setPath)(values, "ingress.className", "alb");
        (0, utils_1.setPath)(values, "ingress.host", helmOptions.subdomain);
        (0, utils_1.setPath)(values, "ingress.annotations", annotations);
        (0, utils_1.setPath)(values, "backstage.image.registry", helmOptions.imageRegistry);
        (0, utils_1.setPath)(values, "backstage.image.repository", helmOptions.imageRepository);
        (0, utils_1.setPath)(values, "backstage.image.tag", helmOptions.imageTag);
        (0, utils_1.setPath)(values, "backstage.appConfig.app.baseUrl", HTTPS + helmOptions.subdomain);
        (0, utils_1.setPath)(values, "backstage.appConfig.backend.baseUrl", HTTPS + helmOptions.subdomain);
        (0, utils_1.setPath)(values, "backstage.appConfig.backend.database", databaseChartValues);
        (0, utils_1.setPath)(values, "backstage.extraEnvVarsSecrets", [helmOptions.databaseSecretTargetName]);
        (0, utils_1.setPath)(values, "backstage.command", ["node", "packages/backend", "--config", "app-config.yaml"]);
        return values;
    }
}
exports.BackstageAddOn = BackstageAddOn;
__decorate([
    (0, utils_1.dependable)('AwsLoadBalancerControllerAddOn'),
    (0, utils_1.dependable)('ExternalsSecretsAddOn')
], BackstageAddOn.prototype, "deploy", null);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvYWRkb25zL2JhY2tzdGFnZS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFDQSw4Q0FBOEQ7QUFDOUQsdUNBQWtEO0FBSWxELDZDQUF3QztBQUV4QyxNQUFNLEtBQUssR0FBRyxVQUFVLENBQUM7QUE0Q3pCOztHQUVHO0FBQ0gsTUFBTSxZQUFZLEdBQUc7SUFDbkIsSUFBSSxFQUFFLDRCQUE0QjtJQUNsQyxTQUFTLEVBQUUsV0FBVztJQUN0QixLQUFLLEVBQUUsV0FBVztJQUNsQixPQUFPLEVBQUUsUUFBUTtJQUNqQixPQUFPLEVBQUUsV0FBVztJQUNwQixVQUFVLEVBQUcsb0NBQW9DO0lBQ2pELFFBQVEsRUFBRSxRQUFRO0lBQ2xCLE1BQU0sRUFBRSxFQUFFO0NBQ1gsQ0FBQztBQUVGOztHQUVHO0FBQ0gsTUFBYSxjQUFlLFNBQVEsc0JBQVM7SUFJM0MsWUFBWSxLQUEyQjtRQUNyQyxLQUFLLENBQUMsRUFBQyxHQUFHLFlBQVksRUFBRSxHQUFHLEtBQUssRUFBQyxDQUFDLENBQUM7UUFDbkMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBNEIsQ0FBQztJQUNuRCxDQUFDO0lBSUQsTUFBTSxDQUFDLFdBQXdCO1FBQzdCLElBQUksTUFBTSxHQUFXLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNwRSxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUVyRCxJQUFJLHVCQUFTLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsb0JBQW9CLEVBQUU7WUFDN0QsS0FBSyxFQUFFLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVM7WUFDckMsV0FBVyxFQUFFLG9CQUFvQjtZQUNqQyxVQUFVLEVBQUUsa0JBQWtCO1NBQy9CLENBQUMsQ0FBQztRQUVILE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUQ7OztNQUdFO0lBQ0YsY0FBYyxDQUFDLFdBQXdCLEVBQUUsV0FBZ0M7O1FBQ3ZFLE1BQU0sTUFBTSxHQUFHLE1BQUEsV0FBVyxDQUFDLE1BQU0sbUNBQUksRUFBRSxDQUFDO1FBRXhDLE1BQU0sV0FBVyxHQUFHO1lBQ2xCLGtDQUFrQyxFQUFFLGlCQUFpQjtZQUNyRCx1Q0FBdUMsRUFBRSxJQUFJO1lBQzdDLDJDQUEyQyxFQUFFLE1BQUEsV0FBVyxDQUFDLFdBQVcsQ0FBZSxXQUFXLENBQUMsdUJBQXVCLENBQUMsMENBQUUsY0FBYztTQUN4SSxDQUFDO1FBRUYsTUFBTSxnQkFBZ0IsR0FBMkIsV0FBVyxDQUFDLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBQ25ILElBQUksZ0JBQWdCLEtBQUssU0FBUyxFQUFFO1lBQ2hDLE1BQU0sSUFBSSxLQUFLLENBQUMsNkJBQTZCLENBQUMsQ0FBQztTQUNsRDtRQUVELE1BQU0sbUJBQW1CLEdBQUc7WUFDMUIsUUFBUSxFQUFFLElBQUk7WUFDZCxZQUFZLEVBQUU7Z0JBQ1osTUFBTSxFQUFFLGdCQUFnQixDQUFDLHlCQUF5QjtnQkFDbEQsTUFBTSxFQUFFLGdCQUFnQixDQUFDLHNCQUFzQjtnQkFDL0MsTUFBTSxFQUFFLGtCQUFrQjtnQkFDMUIsVUFBVSxFQUFFLHNCQUFzQjthQUNuQztTQUNGLENBQUM7UUFFRixJQUFBLGVBQU8sRUFBQyxNQUFNLEVBQUUsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDekMsSUFBQSxlQUFPLEVBQUMsTUFBTSxFQUFFLG1CQUFtQixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzVDLElBQUEsZUFBTyxFQUFDLE1BQU0sRUFBRSxjQUFjLEVBQUUsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3ZELElBQUEsZUFBTyxFQUFDLE1BQU0sRUFBRSxxQkFBcUIsRUFBRSxXQUFXLENBQUMsQ0FBQztRQUVwRCxJQUFBLGVBQU8sRUFBQyxNQUFNLEVBQUUsMEJBQTBCLEVBQUUsV0FBVyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3ZFLElBQUEsZUFBTyxFQUFDLE1BQU0sRUFBRSw0QkFBNEIsRUFBRSxXQUFXLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDM0UsSUFBQSxlQUFPLEVBQUMsTUFBTSxFQUFFLHFCQUFxQixFQUFFLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUU3RCxJQUFBLGVBQU8sRUFBQyxNQUFNLEVBQUUsaUNBQWlDLEVBQUUsS0FBSyxHQUFHLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNsRixJQUFBLGVBQU8sRUFBQyxNQUFNLEVBQUUscUNBQXFDLEVBQUUsS0FBSyxHQUFHLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN0RixJQUFBLGVBQU8sRUFBQyxNQUFNLEVBQUUsc0NBQXNDLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztRQUU3RSxJQUFBLGVBQU8sRUFBQyxNQUFNLEVBQUUsK0JBQStCLEVBQUUsQ0FBQyxXQUFXLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxDQUFDO1FBRXpGLElBQUEsZUFBTyxFQUFDLE1BQU0sRUFBRSxtQkFBbUIsRUFBRSxDQUFDLE1BQU0sRUFBRSxrQkFBa0IsRUFBRSxVQUFVLEVBQUUsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO1FBRWxHLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7Q0FDRjtBQXZFRCx3Q0F1RUM7QUE1REM7SUFGQyxJQUFBLGtCQUFVLEVBQUMsZ0NBQWdDLENBQUM7SUFDNUMsSUFBQSxrQkFBVSxFQUFDLHVCQUF1QixDQUFDOzRDQVluQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5pbXBvcnQgeyBIZWxtQWRkT24sIEhlbG1BZGRPblVzZXJQcm9wcyB9IGZyb20gXCIuLi9oZWxtLWFkZG9uXCI7XG5pbXBvcnQgeyBkZXBlbmRhYmxlLCBzZXRQYXRoIH0gZnJvbSBcIi4uLy4uL3V0aWxzXCI7XG5pbXBvcnQgeyBDbHVzdGVySW5mbywgVmFsdWVzIH0gZnJvbSBcIi4uLy4uL3NwaVwiO1xuaW1wb3J0IHsgSUNlcnRpZmljYXRlIH0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1jZXJ0aWZpY2F0ZW1hbmFnZXJcIjtcbmltcG9ydCAqIGFzIHJkcyBmcm9tIFwiYXdzLWNkay1saWIvYXdzLXJkc1wiO1xuaW1wb3J0IHsgQ2ZuT3V0cHV0IH0gZnJvbSAnYXdzLWNkay1saWInO1xuXG5jb25zdCBIVFRQUyA9IFwiaHR0cHM6Ly9cIjtcblxuLyoqXG4gKiBVc2VyIHByb3ZpZGVkIG9wdGlvbnMgZm9yIHRoZSBIZWxtIENoYXJ0XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQmFja3N0YWdlQWRkT25Qcm9wcyBleHRlbmRzIEhlbG1BZGRPblVzZXJQcm9wcyB7XG4gICAgLyoqXG4gICAgICogVGhlIHN1YmRvbWFpbiB0aGF0IHdpbGwgYmUgYXNzaWduZWQgdG8gdGhlIEJhY2tzdGFnZSBhcHBsaWNhdGlvbi5cbiAgICAgKi9cbiAgICBzdWJkb21haW46IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRoZSByZXNvdXJjZSBuYW1lIG9mIHRoZSBjZXJ0aWZpY2F0ZSB0byBiZSBhc3NpZ25lZCB0byB0aGUgTG9hZCBCYWxhbmNlci5cbiAgICAgKi9cbiAgICBjZXJ0aWZpY2F0ZVJlc291cmNlTmFtZTogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHJlZ2lzdHJ5IFVSTCBvZiB0aGUgQmFja3N0YWdlIGFwcGxpY2F0aW9uJ3MgRG9ja2VyIGltYWdlLlxuICAgICAqL1xuICAgIGltYWdlUmVnaXN0cnk6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRoZSByZXBvc2l0b3J5IG5hbWUgaW4gdGhlIFwiaW1hZ2VSZWdpc3RyeVwiLlxuICAgICAqL1xuICAgIGltYWdlUmVwb3NpdG9yeTogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHRhZyBvZiB0aGUgQmFja3N0YWdlIGFwcGxpY2F0aW9uJ3MgRG9ja2VyIGltYWdlLlxuICAgICAqIEBkZWZhdWx0ICdsYXRlc3QnXG4gICAgICovXG4gICAgaW1hZ2VUYWc/OiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgcmVzb3VyY2UgbmFtZSBvZiB0aGUgZGF0YWJhc2UuXG4gICAgICovXG4gICAgZGF0YWJhc2VSZXNvdXJjZU5hbWU6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFRoZSBuYW1lIG9mIHRoZSBLdWJlcm5ldGVzIFNlY3JldCB3aGljaCB3aWxsIGJlIGNyZWF0ZWQgYnkgdGhlIGFkZC1vbiBhbmRcbiAgICAgKiBpbmplY3RlZCB3aXRoIHRoZSBkYXRhYmFzZSBjcmVkZW50aWFscy5cbiAgICAgKi9cbiAgICBkYXRhYmFzZVNlY3JldFRhcmdldE5hbWU6IHN0cmluZztcbn1cblxuLyoqXG4gKiBEZWZhdWx0IHByb3BzIHRvIGJlIHVzZWQgd2hlbiBjcmVhdGluZyB0aGUgSGVsbSBjaGFydFxuICovXG5jb25zdCBkZWZhdWx0UHJvcHMgPSB7XG4gIG5hbWU6IFwiYmx1ZXByaW50cy1iYWNrc3RhZ2UtYWRkb25cIixcbiAgbmFtZXNwYWNlOiBcImJhY2tzdGFnZVwiLFxuICBjaGFydDogXCJiYWNrc3RhZ2VcIixcbiAgdmVyc2lvbjogXCIwLjE3LjBcIixcbiAgcmVsZWFzZTogXCJiYWNrc3RhZ2VcIixcbiAgcmVwb3NpdG9yeTogIFwiaHR0cHM6Ly9iYWNrc3RhZ2UuZ2l0aHViLmlvL2NoYXJ0c1wiLFxuICBpbWFnZVRhZzogXCJsYXRlc3RcIixcbiAgdmFsdWVzOiB7fVxufTtcblxuLyoqXG4gKiBNYWluIGNsYXNzIHRvIGluc3RhbnRpYXRlIHRoZSBIZWxtIGNoYXJ0XG4gKi9cbmV4cG9ydCBjbGFzcyBCYWNrc3RhZ2VBZGRPbiBleHRlbmRzIEhlbG1BZGRPbiB7XG5cbiAgcmVhZG9ubHkgb3B0aW9uczogQmFja3N0YWdlQWRkT25Qcm9wcztcblxuICBjb25zdHJ1Y3Rvcihwcm9wcz86IEJhY2tzdGFnZUFkZE9uUHJvcHMpIHtcbiAgICBzdXBlcih7Li4uZGVmYXVsdFByb3BzLCAuLi5wcm9wc30pO1xuICAgIHRoaXMub3B0aW9ucyA9IHRoaXMucHJvcHMgYXMgQmFja3N0YWdlQWRkT25Qcm9wcztcbiAgfVxuICBcbiAgQGRlcGVuZGFibGUoJ0F3c0xvYWRCYWxhbmNlckNvbnRyb2xsZXJBZGRPbicpXG4gIEBkZXBlbmRhYmxlKCdFeHRlcm5hbHNTZWNyZXRzQWRkT24nKVxuICBkZXBsb3koY2x1c3RlckluZm86IENsdXN0ZXJJbmZvKTogUHJvbWlzZTxDb25zdHJ1Y3Q+IHtcbiAgICBsZXQgdmFsdWVzOiBWYWx1ZXMgPSB0aGlzLnBvcHVsYXRlVmFsdWVzKGNsdXN0ZXJJbmZvLCB0aGlzLm9wdGlvbnMpO1xuICAgIGNvbnN0IGNoYXJ0ID0gdGhpcy5hZGRIZWxtQ2hhcnQoY2x1c3RlckluZm8sIHZhbHVlcyk7XG5cbiAgICBuZXcgQ2ZuT3V0cHV0KGNsdXN0ZXJJbmZvLmNsdXN0ZXIuc3RhY2ssICdCYWNrc3RhZ2UgYmFzZSBVUkwnLCB7XG4gICAgICB2YWx1ZTogSFRUUFMgKyB0aGlzLm9wdGlvbnMuc3ViZG9tYWluLFxuICAgICAgZGVzY3JpcHRpb246IFwiQmFja3N0YWdlIGJhc2UgVVJMXCIsXG4gICAgICBleHBvcnROYW1lOiBcIkJhY2tzdGFnZUJhc2VVcmxcIixcbiAgICB9KTtcblxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY2hhcnQpO1xuICB9XG5cbiAgLyoqXG4gICogcG9wdWxhdGVWYWx1ZXMgcG9wdWxhdGVzIHRoZSBhcHByb3ByaWF0ZSB2YWx1ZXMgdXNlZCB0byBjdXN0b21pemUgdGhlIEhlbG0gY2hhcnRcbiAgKiBAcGFyYW0gaGVsbU9wdGlvbnMgVXNlciBwcm92aWRlZCB2YWx1ZXMgdG8gY3VzdG9taXplIHRoZSBjaGFydFxuICAqL1xuICBwb3B1bGF0ZVZhbHVlcyhjbHVzdGVySW5mbzogQ2x1c3RlckluZm8sIGhlbG1PcHRpb25zOiBCYWNrc3RhZ2VBZGRPblByb3BzKTogVmFsdWVzIHtcbiAgICBjb25zdCB2YWx1ZXMgPSBoZWxtT3B0aW9ucy52YWx1ZXMgPz8ge307XG4gICAgXG4gICAgY29uc3QgYW5ub3RhdGlvbnMgPSB7XG4gICAgICBcImFsYi5pbmdyZXNzLmt1YmVybmV0ZXMuaW8vc2NoZW1lXCI6IFwiaW50ZXJuZXQtZmFjaW5nXCIsXG4gICAgICBcImFsYi5pbmdyZXNzLmt1YmVybmV0ZXMuaW8vdGFyZ2V0LXR5cGVcIjogXCJpcFwiLFxuICAgICAgXCJhbGIuaW5ncmVzcy5rdWJlcm5ldGVzLmlvL2NlcnRpZmljYXRlLWFyblwiOiBjbHVzdGVySW5mby5nZXRSZXNvdXJjZTxJQ2VydGlmaWNhdGU+KGhlbG1PcHRpb25zLmNlcnRpZmljYXRlUmVzb3VyY2VOYW1lKT8uY2VydGlmaWNhdGVBcm5cbiAgICB9O1xuICBcbiAgICBjb25zdCBkYXRhYmFzZUluc3RhbmNlOiByZHMuSURhdGFiYXNlSW5zdGFuY2UgID0gY2x1c3RlckluZm8uZ2V0UmVxdWlyZWRSZXNvdXJjZShoZWxtT3B0aW9ucy5kYXRhYmFzZVJlc291cmNlTmFtZSk7XG4gICAgaWYgKGRhdGFiYXNlSW5zdGFuY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEYXRhYmFzZSBpbnN0YW5jZSBub3QgZm91bmRcIik7XG4gICAgfVxuICBcbiAgICBjb25zdCBkYXRhYmFzZUNoYXJ0VmFsdWVzID0ge1xuICAgICAgXCJjbGllbnRcIjogXCJwZ1wiLFxuICAgICAgXCJjb25uZWN0aW9uXCI6IHtcbiAgICAgICAgXCJob3N0XCI6IGRhdGFiYXNlSW5zdGFuY2UuZGJJbnN0YW5jZUVuZHBvaW50QWRkcmVzcyxcbiAgICAgICAgXCJwb3J0XCI6IGRhdGFiYXNlSW5zdGFuY2UuZGJJbnN0YW5jZUVuZHBvaW50UG9ydCxcbiAgICAgICAgXCJ1c2VyXCI6IFwiJHtQT1NUR1JFU19VU0VSfVwiLFxuICAgICAgICBcInBhc3N3b3JkXCI6IFwiJHtQT1NUR1JFU19QQVNTV09SRH1cIlxuICAgICAgfVxuICAgIH07XG4gICAgXG4gICAgc2V0UGF0aCh2YWx1ZXMsIFwiaW5ncmVzcy5lbmFibGVkXCIsIHRydWUpO1xuICAgIHNldFBhdGgodmFsdWVzLCBcImluZ3Jlc3MuY2xhc3NOYW1lXCIsIFwiYWxiXCIpO1xuICAgIHNldFBhdGgodmFsdWVzLCBcImluZ3Jlc3MuaG9zdFwiLCBoZWxtT3B0aW9ucy5zdWJkb21haW4pO1xuICAgIHNldFBhdGgodmFsdWVzLCBcImluZ3Jlc3MuYW5ub3RhdGlvbnNcIiwgYW5ub3RhdGlvbnMpO1xuICBcbiAgICBzZXRQYXRoKHZhbHVlcywgXCJiYWNrc3RhZ2UuaW1hZ2UucmVnaXN0cnlcIiwgaGVsbU9wdGlvbnMuaW1hZ2VSZWdpc3RyeSk7XG4gICAgc2V0UGF0aCh2YWx1ZXMsIFwiYmFja3N0YWdlLmltYWdlLnJlcG9zaXRvcnlcIiwgaGVsbU9wdGlvbnMuaW1hZ2VSZXBvc2l0b3J5KTtcbiAgICBzZXRQYXRoKHZhbHVlcywgXCJiYWNrc3RhZ2UuaW1hZ2UudGFnXCIsIGhlbG1PcHRpb25zLmltYWdlVGFnKTtcbiAgXG4gICAgc2V0UGF0aCh2YWx1ZXMsIFwiYmFja3N0YWdlLmFwcENvbmZpZy5hcHAuYmFzZVVybFwiLCBIVFRQUyArIGhlbG1PcHRpb25zLnN1YmRvbWFpbik7XG4gICAgc2V0UGF0aCh2YWx1ZXMsIFwiYmFja3N0YWdlLmFwcENvbmZpZy5iYWNrZW5kLmJhc2VVcmxcIiwgSFRUUFMgKyBoZWxtT3B0aW9ucy5zdWJkb21haW4pO1xuICAgIHNldFBhdGgodmFsdWVzLCBcImJhY2tzdGFnZS5hcHBDb25maWcuYmFja2VuZC5kYXRhYmFzZVwiLCBkYXRhYmFzZUNoYXJ0VmFsdWVzKTtcblxuICAgIHNldFBhdGgodmFsdWVzLCBcImJhY2tzdGFnZS5leHRyYUVudlZhcnNTZWNyZXRzXCIsIFtoZWxtT3B0aW9ucy5kYXRhYmFzZVNlY3JldFRhcmdldE5hbWVdKTtcbiAgXG4gICAgc2V0UGF0aCh2YWx1ZXMsIFwiYmFja3N0YWdlLmNvbW1hbmRcIiwgW1wibm9kZVwiLCBcInBhY2thZ2VzL2JhY2tlbmRcIiwgXCItLWNvbmZpZ1wiLCBcImFwcC1jb25maWcueWFtbFwiXSk7XG4gICAgXG4gICAgcmV0dXJuIHZhbHVlcztcbiAgfVxufVxuIl19