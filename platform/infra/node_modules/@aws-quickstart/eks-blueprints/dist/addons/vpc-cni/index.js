"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VpcCniAddOn = void 0;
const utils_1 = require("../../utils");
const core_addon_1 = require("../core-addon");
const kubectl_provider_1 = require("../helm-addon/kubectl-provider");
const defaultProps = {
    addOnName: 'vpc-cni',
    version: 'v1.13.4-eksbuild.1',
    saName: 'aws-node',
    namespace: 'kube-system',
    controlPlaneAddOn: false,
    configurationValues: {}
};
/**
 * Implementation of VpcCni EKS add-on with Advanced Configurations.
 */
class VpcCniAddOn extends core_addon_1.CoreAddOn {
    constructor(props) {
        super({ ...defaultProps, ...props });
        this.vpcCniAddOnProps = { ...defaultProps, ...props };
        this.coreAddOnProps.configurationValues = populateVpcCniConfigurationValues(props);
    }
    deploy(clusterInfo) {
        var _a;
        const cluster = clusterInfo.cluster;
        let clusterSecurityGroupId = cluster.clusterSecurityGroupId;
        if (((_a = this.vpcCniAddOnProps.customNetworkingConfig) === null || _a === void 0 ? void 0 : _a.subnets)) {
            for (let subnet of this.vpcCniAddOnProps.customNetworkingConfig.subnets) {
                const doc = (0, utils_1.readYamlDocument)(__dirname + '/eniConfig.ytpl');
                const manifest = doc.split("---").map(e => (0, utils_1.loadYaml)(e));
                const values = {
                    availabilityZone: subnet.availabilityZone,
                    clusterSecurityGroupId: clusterSecurityGroupId,
                    subnetId: subnet.subnetId
                };
                const manifestDeployment = {
                    name: "EniCustomConfig" + subnet,
                    namespace: this.coreAddOnProps.namespace,
                    manifest,
                    values,
                };
                const kubectlProvider = new kubectl_provider_1.KubectlProvider(clusterInfo);
                kubectlProvider.addManifest(manifestDeployment);
            }
        }
        const addOnPromise = super.deploy(clusterInfo);
        return addOnPromise;
    }
    /**
     * Overrides the core method to provide managed policies.
     * @param _clusterInfo
     * @returns
     */
    provideManagedPolicies(_clusterInfo) {
        return this.vpcCniAddOnProps.serviceAccountPolicies;
    }
    /**
     * Overrides the core addon method in order to replace the SA if exists (which is the case for aws-node).
     * @param clusterInfo
     * @param saNamespace
     * @param policies
     * @returns
     */
    createServiceAccount(clusterInfo, saNamespace, policies) {
        const sa = new utils_1.ReplaceServiceAccount(clusterInfo.cluster, `${this.coreAddOnProps.saName}-sa`, {
            cluster: clusterInfo.cluster,
            name: this.coreAddOnProps.saName,
            namespace: saNamespace
        });
        policies.forEach(p => sa.role.addManagedPolicy(p));
        return sa;
    }
}
exports.VpcCniAddOn = VpcCniAddOn;
function populateVpcCniConfigurationValues(props) {
    if (props === null) {
        return {};
    }
    const result = {
        env: {
            AWS_EC2_ENDPOINT: props === null || props === void 0 ? void 0 : props.awsEc2Endpoint,
            ADDITIONAL_ENI_TAGS: props === null || props === void 0 ? void 0 : props.additionalEniTags,
            ANNOTATE_POD_IP: props === null || props === void 0 ? void 0 : props.annotatePodIp,
            AWS_EXTERNAL_SERVICE_CIDR: props === null || props === void 0 ? void 0 : props.awsExternalServiceCidrs,
            AWS_MANAGE_ENIS_NON_SCHEDULABLE: props === null || props === void 0 ? void 0 : props.awsManageEnisNonSchedulable,
            AWS_VPC_CNI_NODE_PORT_SUPPORT: props === null || props === void 0 ? void 0 : props.awsVpcCniNodePortSupport,
            AWS_VPC_ENI_MTU: props === null || props === void 0 ? void 0 : props.awsVpcEniMtu,
            AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG: props === null || props === void 0 ? void 0 : props.awsVpcK8sCniCustomNetworkCfg,
            AWS_VPC_K8S_CNI_EXCLUDE_SNAT_CIDRS: props === null || props === void 0 ? void 0 : props.awsVpcK8sExcludeSnatCidrs,
            ENI_CONFIG_LABEL_DEF: props === null || props === void 0 ? void 0 : props.eniConfigLabelDef,
            ENI_CONFIG_ANNOTATION_DEF: props === null || props === void 0 ? void 0 : props.eniConfigAnnotationDef,
            AWS_VPC_K8S_CNI_EXTERNALSNAT: props === null || props === void 0 ? void 0 : props.awsVpcK8sCniExternalSnat,
            AWS_VPC_K8S_CNI_LOGLEVEL: props === null || props === void 0 ? void 0 : props.awsVpcK8sCniLogLevel,
            AWS_VPC_K8S_CNI_LOG_FILE: props === null || props === void 0 ? void 0 : props.awsVpcK8sCniLogFile,
            AWS_VPC_K8S_CNI_RANDOMIZESNAT: props === null || props === void 0 ? void 0 : props.awsVpcK8sCniRandomizeSnat,
            AWS_VPC_K8S_CNI_VETHPREFIX: props === null || props === void 0 ? void 0 : props.awsVpcK8sCniVethPrefix,
            AWS_VPC_K8S_PLUGIN_LOG_FILE: props === null || props === void 0 ? void 0 : props.awsVpcK8sPluginLogFile,
            AWS_VPC_K8S_PLUGIN_LOG_LEVEL: props === null || props === void 0 ? void 0 : props.awsVpcK8sPluginLogLevel,
            CLUSTER_ENDPOINT: props === null || props === void 0 ? void 0 : props.clusterEndpoint,
            DISABLE_LEAKED_ENI_CLEANUP: props === null || props === void 0 ? void 0 : props.disableLeakedEniCleanup,
            DISABLE_INTROSPECTION: props === null || props === void 0 ? void 0 : props.disableIntrospection,
            DISABLE_METRICS: props === null || props === void 0 ? void 0 : props.disableMetrics,
            DISABLE_NETWORK_RESOURCE_PROVISIONING: props === null || props === void 0 ? void 0 : props.disablenetworkResourceProvisioning,
            DISABLE_TCP_EARLY_DEMUX: props === null || props === void 0 ? void 0 : props.disableTcpEarlyDemux,
            ENABLE_BANDWIDTH_PLUGIN: props === null || props === void 0 ? void 0 : props.enableBandwidthPlugin,
            ENABLE_NFTABLES: props === null || props === void 0 ? void 0 : props.enableNftables,
            ENABLE_POD_ENI: props === null || props === void 0 ? void 0 : props.enablePodEni,
            ENABLE_PREFIX_DELEGATION: props === null || props === void 0 ? void 0 : props.enablePrefixDelegation,
            ENABLE_V6_EGRESS: props === null || props === void 0 ? void 0 : props.enableV6Egress,
            INTROSPECTION_BIND_ADDRESS: props === null || props === void 0 ? void 0 : props.introspectionBindAddress,
            MAX_ENI: props === null || props === void 0 ? void 0 : props.maxEni,
            MINIMUM_IP_TARGET: props === null || props === void 0 ? void 0 : props.minimumIpTarget,
            POD_SECURITY_GROUP_ENFORCING_MODE: props === null || props === void 0 ? void 0 : props.podSecurityGroupEnforcingMode,
            WARM_ENI_TARGET: props === null || props === void 0 ? void 0 : props.warmEniTarget,
            WARM_IP_TARGET: props === null || props === void 0 ? void 0 : props.warmIpTarget,
            WARM_PREFIX_TARGET: props === null || props === void 0 ? void 0 : props.warmPrefixTarget
        }
    };
    // clean up all undefined
    const values = result.env;
    Object.keys(values).forEach(key => values[key] === undefined ? delete values[key] : {});
    Object.keys(values).forEach(key => values[key] = typeof values[key] !== 'string' ? JSON.stringify(values[key]) : values[key]);
    return result;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvYWRkb25zL3ZwYy1jbmkvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBS0EsdUNBQWdGO0FBQ2hGLDhDQUEwRDtBQUMxRCxxRUFBcUY7QUE2UnJGLE1BQU0sWUFBWSxHQUFtQjtJQUNuQyxTQUFTLEVBQUUsU0FBUztJQUNwQixPQUFPLEVBQUUsb0JBQW9CO0lBQzdCLE1BQU0sRUFBRSxVQUFVO0lBQ2xCLFNBQVMsRUFBRSxhQUFhO0lBQ3hCLGlCQUFpQixFQUFFLEtBQUs7SUFDeEIsbUJBQW1CLEVBQUUsRUFBRTtDQUN4QixDQUFDO0FBRUY7O0dBRUc7QUFDSCxNQUFhLFdBQVksU0FBUSxzQkFBUztJQUt4QyxZQUFZLEtBQXdCO1FBQ2xDLEtBQUssQ0FBQyxFQUFFLEdBQUcsWUFBWSxFQUFFLEdBQUcsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxHQUFHLFlBQVksRUFBRSxHQUFHLEtBQUssRUFBRSxDQUFDO1FBQ3JELElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQTJCLEdBQUcsaUNBQWlDLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDOUYsQ0FBQztJQUVELE1BQU0sQ0FBQyxXQUF3Qjs7UUFDN0IsTUFBTSxPQUFPLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQztRQUNwQyxJQUFJLHNCQUFzQixHQUFHLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQztRQUU1RCxJQUFJLENBQUMsTUFBQSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsc0JBQXNCLDBDQUFFLE9BQU8sQ0FBQyxFQUFFO1lBQzNELEtBQUssSUFBSSxNQUFNLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLHNCQUFzQixDQUFDLE9BQU8sRUFBRTtnQkFDdkUsTUFBTSxHQUFHLEdBQUcsSUFBQSx3QkFBZ0IsRUFBQyxTQUFTLEdBQUcsaUJBQWlCLENBQUMsQ0FB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R0FBRyxDQUFDLENBQUMsQ0FBQSxDQUFDLENBQUEsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFFN0gsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElTdWJuZXQgfSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWVjMlwiO1xuaW1wb3J0ICogYXMgZWtzIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtZWtzXCI7XG5pbXBvcnQgKiBhcyBpYW0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1pYW1cIjtcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgQ2x1c3RlckluZm8sIFZhbHVlcyB9IGZyb20gXCIuLi8uLi9zcGlcIjtcbmltcG9ydCB7IGxvYWRZYW1sLCByZWFkWWFtbERvY3VtZW50LCBSZXBsYWNlU2VydmljZUFjY291bnQgfSBmcm9tIFwiLi4vLi4vdXRpbHNcIjtcbmltcG9ydCB7IENvcmVBZGRPbiwgQ29yZUFkZE9uUHJvcHMgfSBmcm9tIFwiLi4vY29yZS1hZGRvblwiO1xuaW1wb3J0IHsgS3ViZWN0bFByb3ZpZGVyLCBNYW5pZmVzdERlcGxveW1lbnQgfSBmcm9tIFwiLi4vaGVsbS1hZGRvbi9rdWJlY3RsLXByb3ZpZGVyXCI7XG5cbi8qKlxuICogVXNlciBwcm92aWRlZCBvcHRpb24gZm9yIHRoZSBIZWxtIENoYXJ0XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVnBjQ25pQWRkT25Qcm9wcyB7XG5cbiAgLyoqXG4gICAqIGBBRERJVElPTkFMX0VOSV9UQUdTYCBFbnZpcm9ubWVudCBWYXJpYWJsZS4gVHlwZTogU3RyaW5nLlxuICAgKiBNZXRhZGF0YSBhcHBsaWVkIHRvIEVOSSBoZWxwcyB5b3UgY2F0ZWdvcml6ZSBhbmQgb3JnYW5pemUgeW91ciBcbiAgICogcmVzb3VyY2VzIGZvciBiaWxsaW5nIG9yIG90aGVyIHB1cnBvc2VzLiBcbiAgICovXG4gIGFkZGl0aW9uYWxFbmlUYWdzPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBgQU5OT1RBVEVfUE9EX0lQYCBFbnZpcm9ubWVudCBWYXJpYWJsZS4gVHlwZTogQm9vbGVhbi5cbiAgICogU2V0dGluZyBBTk5PVEFURV9QT0RfSVAgdG8gdHJ1ZSB3aWxsIGFsbG93IElQQU1EIHRvIGFkZCBhbiBhbm5vdGF0aW9uIFxuICAgKiB2cGMuYW1hem9uYXdzLmNvbS9wb2QtaXBzIHRvIHRoZSBwb2Qgd2l0aCBwb2QgSVAuXG4gICAqL1xuICBhbm5vdGF0ZVBvZElwPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogYEFXU19FQzJfRU5EUE9JTlRgIEVudmlyb25tZW50IFZhcmlhYmxlLiBUeXBlOiBzdHJpbmcuXG4gICAqIFNwZWNpZmllcyB0aGUgRUMyIGVuZHBvaW50IHRvIHVzZS4gVGhpcyBpcyB1c2VmdWwgaWYgeW91IFxuICAgKiBhcmUgdXNpbmcgYSBjdXN0b20gZW5kcG9pbnQgZm9yIEVDMi4gIFxuICAgKi9cbiAgYXdzRWMyRW5kcG9pbnQ/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIGBBV1NfRVhURVJOQUxfU0VSVklDRV9DSURSU2AgRW52aXJvbm1lbnQgVmFyaWFibGUuIFR5cGU6IHN0cmluZy5cbiAgICogU3BlY2lmeSBhIGNvbW1hLXNlcGFyYXRlZCBsaXN0IG9mIElQdjQgQ0lEUnMgdGhhdCBtdXN0IGJlIHJvdXRlZCBcbiAgICogdmlhIG1haW4gcm91dGluZyB0YWJsZS4gVGhpcyBpcyByZXF1aXJlZCBmb3Igc2Vjb25kYXJ5IEVOSXMgdG8gcmVhY2ggXG4gICAqIGVuZHBvaW50cyBvdXRzaWRlIG9mIFZQQyB0aGF0IGFyZSBiYWNrZWQgYnkgYSBzZXJ2aWNlLiBcbiAgICovXG4gIGF3c0V4dGVybmFsU2VydmljZUNpZHJzPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBgQVdTX01BTkFHRV9FTklTX05PTl9TQ0hFRFVMQUJMRWAgRW52aXJvbm1lbnQgVmFyaWFibGUuIFR5cGU6IEJvb2xlYW4uXG4gICAqIFNwZWNpZmllcyB3aGV0aGVyIElQQU1EIHNob3VsZCBhbGxvY2F0ZSBvciBkZWFsbG9jYXRlIEVOSXMgb24gYSBub24tc2NoZWR1bGFibGUgXG4gICAqIG5vZGUuXG4gICAqL1xuICBhd3NNYW5hZ2VFbmlzTm9uU2NoZWR1bGFibGU/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBgQVdTX1ZQQ19DTklfTk9ERV9QT1JUX1NVUFBPUlRgIEVudmlyb25tZW50IFZhcmlhYmxlLiBUeXBlOiBCb29sZWFuLlxuICAgKiBTcGVjaWZpZXMgd2hldGhlciBOb2RlUG9ydCBzZXJ2aWNlcyBhcmUgZW5hYmxlZCBvbiBhIHdvcmtlciBub2RlJ3MgcHJpbWFyeSBcbiAgICogbmV0d29yayBpbnRlcmZhY2UuIFxuICAgKi9cbiAgYXdzVnBjQ25pTm9kZVBvcnRTdXBwb3J0PzogYm9vbGVhbjtcblxuICAvKipcbiAgICogYEFXU19WUENfRU5JX01UVWAgRW52aXJvbm1lbnQgVmFyaWFibGUuIFR5cGU6IEludGVnZXIuXG4gICAqIFVzZWQgdG8gY29uZmlndXJlIHRoZSBNVFUgc2l6ZSBmb3IgYXR0YWNoZWQgRU5Jcy4gVGhlIHZhbGlkIHJhbmdlIGlzIFxuICAgKiBmcm9tIDU3NiB0byA5MDAxLlxuICAgKi9cbiAgYXdzVnBjRW5pTXR1PzogbnVtYmVyO1xuXG4gIC8qKlxuICAqIGBBV1NfVlBDX0s4U19DTklfQ1VTVE9NX05FVFdPUktfQ0ZHYCBFbnZpcm9ubWVudCBWYXJpYWJsZS4gVHlwZTogQm9vbGVhbi5cbiAgKiBTcGVjaWZpZXMgdGhhdCB5b3VyIHBvZHMgbWF5IHVzZSBzdWJuZXRzIGFuZCBzZWN1cml0eSBncm91cHMgdGhhdCBhcmUgXG4gICogaW5kZXBlbmRlbnQgb2YgeW91ciB3b3JrZXIgbm9kZSdzIFZQQyBjb25maWd1cmF0aW9uLlxuICAqL1xuICBhd3NWcGNLOHNDbmlDdXN0b21OZXR3b3JrQ2ZnPzogYm9vbGVhbjtcblxuICAvKipcbiAgKiBgQVdTX1ZQQ19LOFNfQ05JX1ZFVEhQUkVGSVhgIEVudmlyb25tZW50IFZhcmlhYmxlLiBUeXBlOiBTdHJpbmcuXG4gICogU3BlY2lmaWVzIHRoZSB2ZXRoIHByZWZpeCB1c2VkIHRvIGdlbmVyYXRlIHRoZSBob3N0LXNpZGUgdmV0aCBkZXZpY2UgbmFtZSBcbiAgKiBmb3IgdGhlIENOSS5cbiAgKi9cbiAgYXdzVnBjSzhzQ25pVmV0aFByZWZpeD86IHN0cmluZztcblxuICAvKipcbiAgKiBgQVdTX1ZQQ19LOFNfQ05JX0VYQ0xVREVfU05BVF9DSURSU2AgRW52aXJvbm1lbnQgVmFyaWFibGUuIFR5cGU6IFN0cmluZy5cbiAgU3BlY2lmeSBhIGNvbW1hLXNlcGFyYXRlZCBsaXN0IG9mIElQdjQgQ0lEUnMgdG8gZXhjbHVkZSBmcm9tIFNOQVQuXG4gICovXG4gIGF3c1ZwY0s4c0V4Y2x1ZGVTbmF0Q2lkcnM/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICogYEFXU19WUENfSzhTX0NOSV9MT0dMRVZFTGAgRW52aXJvbm1lbnQgVmFyaWFibGUuIFR5cGU6IFN0cmluZy5cbiAgKiBTcGVjaWZpZXMgdGhlIGxvZ2xldmVsIGZvciBpcGFtZCBhbmQgY25pLW1ldHJpYy1oZWxwZXIuXG4gICovXG4gIGF3c1ZwY0s4c0NuaUxvZ0xldmVsPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBgQVdTX1ZQQ19LOFNfQ05JX0xPR19GSUxFYCBFbnZpcm9ubWVudCBWYXJpYWJsZS4gVHlwZTogU3RyaW5nLlxuICAgKiBTcGVjaWZpZXMgd2hlcmUgdG8gd3JpdGUgdGhlIGxvZ2dpbmcgb3V0cHV0IG9mIGlwYW1kLiBFaXRoZXIgdG8gc3Rkb3V0IFxuICAgKiBvciB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBmaWxlIChpLmUuLCAvdmFyL2xvZy9hd3Mtcm91dGVkLWVuaS9pcGFtZC5sb2cpLlxuICAgKi9cbiAgYXdzVnBjSzhzQ25pTG9nRmlsZT86IHN0cmluZztcblxuICAvKipcbiAgICogYEFXU19WUENfSzhTX0NOSV9SQU5ET01JWkVTTkFUYCBFbnZpcm9ubWVudCBWYXJpYWJsZS4gVHlwZTogU3RyaW5nLlxuICAgKiBTcGVjaWZpZXMgd2hldGhlciB0aGUgU05BVCBpcHRhYmxlcyBydWxlIHNob3VsZCByYW5kb21pemUgdGhlIG91dGdvaW5nIFxuICAgKiBwb3J0cyBmb3IgY29ubmVjdGlvbnMuXG4gICAqL1xuICBhd3NWcGNLOHNDbmlSYW5kb21pemVTbmF0Pzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBgQVdTX1ZQQ19LOFNfQ05JX0VYVEVSTkFMU05BVGAgRW52aXJvbm1lbnQgVmFyaWFibGUuIFR5cGU6IEJvb2xlYW4uXG4gICAqIFNwZWNpZmllcyB3aGV0aGVyIGFuIGV4dGVybmFsIE5BVCBnYXRld2F5IHNob3VsZCBiZSB1c2VkIHRvIHByb3ZpZGUgU05BVCBcbiAgICogb2Ygc2Vjb25kYXJ5IEVOSSBJUCBhZGRyZXNzZXMuXG4gICAqL1xuICBhd3NWcGNLOHNDbmlFeHRlcm5hbFNuYXQ/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBgQVdTX1ZQQ19LOFNfUExVR0lOX0xPR19GSUxFYCBFbnZpcm9ubWVudCBWYXJpYWJsZS4gVHlwZTogU3RyaW5nLlxuICAgKiBTcGVjaWZpZXMgd2hlcmUgdG8gd3JpdGUgdGhlIGxvZ2dpbmcgb3V0cHV0IGZvciBhd3MtY25pIHBsdWdpbi4gXG4gICAqL1xuICBhd3NWcGNLOHNQbHVnaW5Mb2dGaWxlPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBgQVdTX1ZQQ19LOFNfUExVR0lOX0xPR19MRVZFTGAgRW52aXJvbm1lbnQgVmFyaWFibGUuIFR5cGU6IFN0cmluZy5cbiAgICogU3BlY2lmaWVzIHRoZSBsb2dsZXZlbCBmb3IgYXdzLWNuaSBwbHVnaW4uXG4gICAqL1xuICBhd3NWcGNLOHNQbHVnaW5Mb2dMZXZlbD86IHN0cmluZztcblxuICAvKipcbiAgICogYENMVVNURVJfRU5EUE9JTlRgIEVudmlyb25tZW50IFZhcmlhYmxlLiBUeXBlOiBTdHJpbmcuXG4gICAqIFNwZWNpZmllcyB0aGUgY2x1c3RlciBlbmRwb2ludCB0byB1c2UgZm9yIGNvbm5lY3RpbmcgdG8gXG4gICAqIHRoZSBhcGktc2VydmVyIHdpdGhvdXQgcmVseWluZyBvbiBrdWJlLXByb3h5LiBcbiAgICovXG4gIGNsdXN0ZXJFbmRwb2ludD86IHN0cmluZztcblxuICAvKipcbiAgICogQ3VzdG9tTmV0d29ya2luZ0NvbmZpZyBob2xkaW5nIFNlY29uZGFyeSBTdWJuZXQgSURzIGZvciBjcmVhdGluZyBgRU5JQ29uZmlnYFxuICAgKi9cbiAgY3VzdG9tTmV0d29ya2luZ0NvbmZpZz86IEN1c3RvbU5ldHdvcmtpbmdDb25maWc7XG5cbiAgLyoqXG4gICAqIGBESVNBQkxFX0xFQUtFRF9FTklfQ0xFQU5VUGAgRW52aXJvbm1lbnQgVmFyaWFibGUuIFR5cGU6IEJvb2xlYW4uXG4gICAqL1xuICBkaXNhYmxlTGVha2VkRW5pQ2xlYW51cD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIGBESVNBQkxFX0lOVFJPU1BFQ1RJT05gIEVudmlyb25tZW50IFZhcmlhYmxlLiBUeXBlOiBCb29sZWFuLlxuICAgKi9cbiAgZGlzYWJsZUludHJvc3BlY3Rpb24/OiBib29sZWFuO1xuXG4gIC8qKlxuICAqIGBESVNBQkxFX01FVFJJQ1NgIEVudmlyb25tZW50IFZhcmlhYmxlLiBUeXBlOiBCb29sZWFuLlxuICAqIFNwZWNpZmllcyB3aGV0aGVyIHRoZSBwcm9tZXRoZXVzIG1ldHJpY3MgZW5kcG9pbnQgaXMgZGlzYWJsZWQgb3Igbm90IGZvciBcbiAgKiBpcGFtZC4gQnkgZGVmYXVsdCBtZXRyaWNzIGFyZSBwdWJsaXNoZWQgb24gOjYxNjc4L21ldHJpY3MuXG4gICovXG4gIGRpc2FibGVNZXRyaWNzPzogYm9vbGVhbjtcblxuICAvKipcbiAgKiBgRElTQUJMRV9ORVRXT1JLX1JFU09VUkNFX1BST1ZJU0lPTklOR2AgRW52aXJvbm1lbnQgVmFyaWFibGUuIFR5cGU6IEJvb2xlYW4uXG4gICogU2V0dGluZyBESVNBQkxFX05FVFdPUktfUkVTT1VSQ0VfUFJPVklTSU9OSU5HIHRvIHRydWUgd2lsbCBtYWtlIElQQU1EIFxuICAqIGRlcGVuZCBvbmx5IG9uIElNRFMgdG8gZ2V0IGF0dGFjaGVkIEVOSXMgYW5kIElQcy9wcmVmaXhlcy5cbiAgKi9cbiAgZGlzYWJsZW5ldHdvcmtSZXNvdXJjZVByb3Zpc2lvbmluZz86IGJvb2xlYW47XG5cbiAgLyoqXG4gICogYERJU0FCTEVfVENQX0VBUkxZX0RFTVVYYCBFbnZpcm9ubWVudCBWYXJpYWJsZS4gVHlwZTogQm9vbGVhbi5cbiAgKiBJZiBFTkFCTEVfUE9EX0VOSSBpcyBzZXQgdG8gdHJ1ZSwgZm9yIHRoZSBrdWJlbGV0IHRvIGNvbm5lY3QgdmlhIFRDUFxuICAqIHRvIHBvZHMgdGhhdCBhcmUgdXNpbmcgcGVyIHBvZCBzZWN1cml0eSBncm91cHMsIERJU0FCTEVfVENQX0VBUkxZX0RFTVVYIFxuICAqIHNob3VsZCBiZSBzZXQgdG8gdHJ1ZSBmb3IgYW1hem9uLWs4cy1jbmktaW5pdCB0aGUgY29udGFpbmVyIHVuZGVyIGluaXRjb250YWluZXJzLlxuICAqL1xuICBkaXNhYmxlVGNwRWFybHlEZW11eD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICogYEVOQUJMRV9CQU5EV0lEVEhfUExVR0lOYCBFbnZpcm9ubWVudCBWYXJpYWJsZS4gVHlwZTogQm9vbGVhbi5cbiAgKiBTZXR0aW5nIEVOQUJMRV9CQU5EV0lEVEhfUExVR0lOIHRvIHRydWUgd2lsbCB1cGRhdGUgMTAtYXdzLmNvbmZsaXN0IHRvIFxuICAqIGluY2x1ZGUgdXBzdHJlYW0gYmFuZHdpZHRoIHBsdWdpbiBhcyBhIGNoYWluZWQgcGx1Z2luLlxuICAqL1xuICBlbmFibGVCYW5kd2lkdGhQbHVnaW4/OiBib29sZWFuO1xuXG4gIC8qKlxuICAqIGBFTkFCTEVfTkZUQUJMRVNgIEVudmlyb25tZW50IFZhcmlhYmxlLiBUeXBlOiBCb29sZWFuLlxuICAqIFZQQyBDTkkgdXNlcyBpcHRhYmxlcy1sZWdhY3kgYnkgZGVmYXVsdC4gU2V0dGluZyBFTkFCTEVfTkZUQUJMRVMgXG4gICogdG8gdHJ1ZSB3aWxsIHVwZGF0ZSBWUEMgQ05JIHRvIHVzZSBpcHRhYmxlcy1uZnRcbiAgKi9cbiAgZW5hYmxlTmZ0YWJsZXM/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBgRU5BQkxFX1BPRF9FTklgIEVudmlyb25tZW50IFZhcmlhYmxlLiBUeXBlOiBCb29sZWFuLlxuICAqIFNldHRpbmcgRU5BQkxFX1BPRF9FTkkgdG8gdHJ1ZSB3aWxsIGFsbG93IElQQU1EIHRvIGFkZCB0aGUgXG4gICogdnBjLmFtYXpvbmF3cy5jb20vaGFzLXRydW5rLWF0dGFjaGVkIGxhYmVsIHRvIHRoZSBub2RlIGlmIHRoZSBpbnN0YW5jZSBcbiAgKiBoYXMgdGhlIGNhcGFjaXR5IHRvIGF0dGFjaCBhbiBhZGRpdGlvbmFsIEVOSS5cbiAgKi9cbiAgZW5hYmxlUG9kRW5pPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogYEVOQUJMRV9QUkVGSVhfREVMRUdBVElPTmAgRW52aXJvbm1lbnQgVmFyaWFibGUuIFR5cGU6IEJvb2xlYW4uXG4gICAqIFRvIGVuYWJsZSBwcmVmaXggZGVsZWdhdGlvbiBvbiBuaXRybyBpbnN0YW5jZXMuIFNldHRpbmcgXG4gICAqIEVOQUJMRV9QUkVGSVhfREVMRUdBVElPTiB0byB0cnVlIHdpbGwgc3RhcnQgYWxsb2NhdGluZyBhIHByZWZpeCAoLzI4IGZvciBJUHY0IGFuZCAvODAgZm9yIElQdjYpIGluc3RlYWQgb2YgYSBzZWNvbmRhcnkgSVAgaW4gdGhlIEVOSXMgc3VibmV0LiBcbiAgKi9cbiAgZW5hYmxlUHJlZml4RGVsZWdhdGlvbj86IGJvb2xlYW47XG5cbiAgLyoqXG4gICogYEVOQUJMRV9WNl9FR1JFU1NgIEVudmlyb25tZW50IFZhcmlhYmxlLiBUeXBlOiBCb29sZWFuLlxuICAqIFNwZWNpZmllcyB3aGV0aGVyIFBPRHMgaW4gYW4gSVB2NCBjbHVzdGVyIHN1cHBvcnQgSVB2NiBlZ3Jlc3MuIFxuICAqIElmIGVudiBpcyBzZXQgdG8gdHJ1ZSwgcmFuZ2UgZmQwMDo6YWM6MDAvMTE4IGlzIHJlc2VydmVkIGZvciBJUHY2IGVncmVzcy5cbiAgKi9cbiAgZW5hYmxlVjZFZ3Jlc3M/OiBib29sZWFuO1xuXG4gIC8qKlxuICAqIGBFTklfQ09ORklHX0xBQkVMX0RFRmAgRW52aXJvbm1lbnQgVmFyaWFibGUuIFR5cGU6IFN0cmluZy5cbiAgKiBTcGVjaWZpZXMgbm9kZSBsYWJlbCBrZXkgbmFtZS4gVGhpcyBzaG91bGQgYmUgdXNlZCB3aGVuIFxuICAqIEFXU19WUENfSzhTX0NOSV9DVVNUT01fTkVUV09SS19DRkc9dHJ1ZS5cbiAgKi9cbiAgZW5pQ29uZmlnTGFiZWxEZWY/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIGBFTklfQ09ORklHX0FOTk9UQVRJT05fREVGYCBFbnZpcm9ubWVudCBWYXJpYWJsZS4gVHlwZTogU3RyaW5nLiBcbiAgICogU3BlY2lmaWVzIG5vZGUgYW5ub3RhdGlvbiBrZXkgbmFtZS4gVGhpcyBzaG91bGQgYmUgdXNlZCB3aGVuIFxuICAgKiBBV1NfVlBDX0s4U19DTklfQ1VTVE9NX05FVFdPUktfQ0ZHPXRydWVcbiAgKi9cbiAgZW5pQ29uZmlnQW5ub3RhdGlvbkRlZj86IHN0cmluZztcblxuICAvKipcbiAgICogYElOVFJPU1BFQ1RJT05fQklORF9BRERSRVNTYCBFbnZpcm9ubWVudCBWYXJpYWJsZS4gVHlwZTogU3RyaW5nLiBcbiAgICogU3BlY2lmaWVzIHRoZSBiaW5kIGFkZHJlc3MgZm9yIHRoZSBpbnRyb3NwZWN0aW9uIGVuZHBvaW50LlxuICAqL1xuICBpbnRyb3NwZWN0aW9uQmluZEFkZHJlc3M/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICogYE1BWF9FTklgIEVudmlyb25tZW50IFZhcmlhYmxlLiBGb3JtYXQgaW50ZWdlci5cbiAgKiBTcGVjaWZpZXMgdGhlIG1heGltdW0gbnVtYmVyIG9mIEVOSXMgdGhhdCB3aWxsIGJlIGF0dGFjaGVkIHRvIHRoZSBub2RlLiBcbiAgKi9cbiAgbWF4RW5pPzogbnVtYmVyOyAgXG5cbiAgLyoqXG4gICogYE1JTklNVU1fSVBfVEFSR0VUYCBFbnZpcm9ubWVudCBWYXJpYWJsZS4gRm9ybWF0IGludGVnZXIuXG4gICogU3BlY2lmaWVzIHRoZSBudW1iZXIgb2YgdG90YWwgSVAgYWRkcmVzc2VzIHRoYXQgdGhlIGlwYW1kIFxuICAqIGRhZW1vbiBzaG91bGQgYXR0ZW1wdCB0byBhbGxvY2F0ZSBmb3IgcG9kIGFzc2lnbm1lbnQgb24gdGhlIG5vZGUuXG4gICovXG4gIG1pbmltdW1JcFRhcmdldD86IG51bWJlcjsgXG5cbiAgLyoqXG4gICAqIGBQT0RfU0VDVVJJVFlfR1JPVVBfRU5GT1JDSU5HX01PREVgIEVudmlyb25tZW50IFZhcmlhYmxlLiBUeXBlOiBTdHJpbmcuIFxuICAgKiBPbmNlIEVOQUJMRV9QT0RfRU5JIGlzIHNldCB0byB0cnVlLCB0aGlzIHZhbHVlIGNvbnRyb2xzIGhvdyB0aGUgdHJhZmZpYyBcbiAgICogb2YgcG9kcyB3aXRoIHRoZSBzZWN1cml0eSBncm91cCBiZWhhdmVzLlxuICAqL1xuICBwb2RTZWN1cml0eUdyb3VwRW5mb3JjaW5nTW9kZT86IHN0cmluZztcblxuICAvKipcbiAgKiBgV0FSTV9FTklfVEFSR0VUYCBFbnZpcm9ubWVudCBWYXJpYWJsZS4gRm9ybWF0IGludGVnZXIuXG4gICogU3BlY2lmaWVzIHRoZSBudW1iZXIgb2YgZnJlZSBlbGFzdGljIG5ldHdvcmsgaW50ZXJmYWNlcyAoYW5kIGFsbCBvZiB0aGVpciBcbiAgKiBhdmFpbGFibGUgSVAgYWRkcmVzc2VzKSB0aGF0IHRoZSBpcGFtZCBkYWVtb24gc2hvdWxkIGF0dGVtcHQgdG8ga2VlcCBcbiAgKiBhdmFpbGFibGUgZm9yIHBvZCBhc3NpZ25tZW50IG9uIHRoZSBub2RlLiBcbiAgKi9cbiAgd2FybUVuaVRhcmdldD86IG51bWJlcjtcblxuICAvKipcbiAgKiBgV0FSTV9JUF9UQVJHRVRgIEVudmlyb25tZW50IFZhcmlhYmxlLiBGb3JtYXQgaW50ZWdlci5cbiAgKiBTcGVjaWZpZXMgdGhlIG51bWJlciBvZiBmcmVlIElQIGFkZHJlc3NlcyB0aGF0IHRoZSBpcGFtZCBkYWVtb24gXG4gICogc2hvdWxkIGF0dGVtcHQgdG8ga2VlcCBhdmFpbGFibGUgZm9yIHBvZCBhc3NpZ25tZW50IG9uIHRoZSBub2RlLlxuICAqL1xuICB3YXJtSXBUYXJnZXQ/OiBudW1iZXI7XG5cbiAgLyoqXG4gICogYFdBUk1fUFJFRklYX1RBUkdFVGAgRW52aXJvbm1lbnQgVmFyaWFibGUuIEZvcm1hdCBpbnRlZ2VyLlxuICAqIFNwZWNpZmllcyB0aGUgbnVtYmVyIG9mIGZyZWUgSVB2NCgvMjgpIHByZWZpeGVzIHRoYXQgdGhlIGlwYW1kIGRhZW1vbiBcbiAgKiBzaG91bGQgYXR0ZW1wdCB0byBrZWVwIGF2YWlsYWJsZSBmb3IgcG9kIGFzc2lnbm1lbnQgb24gdGhlIG5vZGUuXG4gICovXG4gIHdhcm1QcmVmaXhUYXJnZXQ/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIElmIHNwZWNpZmllZCwgYW4gSVJTQSBhY2NvdW50IHdpbGwgYmUgY3JlYXRlZCBmb3IgdGhlIFZQQy1DTkkgYWRkLW9uIHdpdGggdGhlIElSU0Egcm9sZVxuICAgKiBoYXZpbmcgdGhlIHNwZWNpZmllZCBtYW5hZ2VkIHBvbGljaWVzLiBXaGVuIHNwZWNpZmllZCwgdGhlIG5vZGUgcm9sZSBmb3IgdGhlIGNsdXN0ZXIgcHJvdmlkZXIgY2FuIGJlIGNvbmZpZ3VyZWQgXG4gICAqIHdpdGhvdXQgdGhlIENOSSBwb2xpY3kuIFxuICAgKiBcbiAgICogRm9yIElQdjQgdGhlIHJlcXVpcmVkIG1hbmFnZWQgcG9saWN5IGlzIEFtYXpvbkVLU19DTklfUG9saWN5LlxuICAgKiBAZXhhbXBsZVxuICAgKiBzZXJ2aWNlQWNjb3VudFBvbGljaWVzOiBbTWFuYWdlZFBvbGljeS5mcm9tQXdzTWFuYWdlZFBvbGljeU5hbWUoXCJBbWF6b25FS1NfQ05JX1BvbGljeVwiKV1cbiAgICogXG4gICAqL1xuICBzZXJ2aWNlQWNjb3VudFBvbGljaWVzPzogaWFtLklNYW5hZ2VkUG9saWN5W107XG5cbiAgLyoqXG4gICAqIFZlcnNpb24gb2YgdGhlIGFkZC1vbiB0byB1c2UuIE11c3QgbWF0Y2ggdGhlIHZlcnNpb24gb2YgdGhlIGNsdXN0ZXIgd2hlcmUgaXRcbiAgICogd2lsbCBiZSBkZXBsb3llZC5cbiAgICovXG4gIHZlcnNpb24/OiBzdHJpbmc7XG59XG5cblxuZXhwb3J0IGludGVyZmFjZSBDdXN0b21OZXR3b3JraW5nQ29uZmlnIHtcbiAgLyoqXG4gICAqIFNlY29uZGFyeSBzdWJuZXRzIG9mIHlvdXIgVlBDXG4gICAqL1xuICByZWFkb25seSBzdWJuZXRzPzogSVN1Ym5ldFtdO1xufVxuXG5jb25zdCBkZWZhdWx0UHJvcHM6IENvcmVBZGRPblByb3BzID0ge1xuICBhZGRPbk5hbWU6ICd2cGMtY25pJyxcbiAgdmVyc2lvbjogJ3YxLjEzLjQtZWtzYnVpbGQuMScsXG4gIHNhTmFtZTogJ2F3cy1ub2RlJyxcbiAgbmFtZXNwYWNlOiAna3ViZS1zeXN0ZW0nLFxuICBjb250cm9sUGxhbmVBZGRPbjogZmFsc2UsXG4gIGNvbmZpZ3VyYXRpb25WYWx1ZXM6IHt9XG59O1xuXG4vKipcbiAqIEltcGxlbWVudGF0aW9uIG9mIFZwY0NuaSBFS1MgYWRkLW9uIHdpdGggQWR2YW5jZWQgQ29uZmlndXJhdGlvbnMuXG4gKi9cbmV4cG9ydCBjbGFzcyBWcGNDbmlBZGRPbiBleHRlbmRzIENvcmVBZGRPbiB7XG5cbiAgcmVhZG9ubHkgdnBjQ25pQWRkT25Qcm9wczogVnBjQ25pQWRkT25Qcm9wcztcbiAgcmVhZG9ubHkgaWQ/OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IocHJvcHM/OiBWcGNDbmlBZGRPblByb3BzKSB7XG4gICAgc3VwZXIoeyAuLi5kZWZhdWx0UHJvcHMsIC4uLnByb3BzIH0pO1xuICAgIHRoaXMudnBjQ25pQWRkT25Qcm9wcyA9IHsgLi4uZGVmYXVsdFByb3BzLCAuLi5wcm9wcyB9O1xuICAgICh0aGlzLmNvcmVBZGRPblByb3BzLmNvbmZpZ3VyYXRpb25WYWx1ZXMgYXMgYW55KSA9IHBvcHVsYXRlVnBjQ25pQ29uZmlndXJhdGlvblZhbHVlcyhwcm9wcyk7XG4gIH1cblxuICBkZXBsb3koY2x1c3RlckluZm86IENsdXN0ZXJJbmZvKTogUHJvbWlzZTxDb25zdHJ1Y3Q+IHtcbiAgICBjb25zdCBjbHVzdGVyID0gY2x1c3RlckluZm8uY2x1c3RlcjtcbiAgICBsZXQgY2x1c3RlclNlY3VyaXR5R3JvdXBJZCA9IGNsdXN0ZXIuY2x1c3RlclNlY3VyaXR5R3JvdXBJZDtcblxuICAgIGlmICgodGhpcy52cGNDbmlBZGRPblByb3BzLmN1c3RvbU5ldHdvcmtpbmdDb25maWc/LnN1Ym5ldHMpKSB7XG4gICAgICBmb3IgKGxldCBzdWJuZXQgb2YgdGhpcy52cGNDbmlBZGRPblByb3BzLmN1c3RvbU5ldHdvcmtpbmdDb25maWcuc3VibmV0cykge1xuICAgICAgICBjb25zdCBkb2MgPSByZWFkWWFtbERvY3VtZW50KF9fZGlybmFtZSArICcvZW5pQ29uZmlnLnl0cGwnKTtcbiAgICAgICAgY29uc3QgbWFuaWZlc3QgPSBkb2Muc3BsaXQoXCItLS1cIikubWFwKGUgPT4gbG9hZFlhbWwoZSkpO1xuICAgICAgICBjb25zdCB2YWx1ZXM6IFZhbHVlcyA9IHtcbiAgICAgICAgICBhdmFpbGFiaWxpdHlab25lOiBzdWJuZXQuYXZhaWxhYmlsaXR5Wm9uZSxcbiAgICAgICAgICBjbHVzdGVyU2VjdXJpdHlHcm91cElkOiBjbHVzdGVyU2VjdXJpdHlHcm91cElkLFxuICAgICAgICAgIHN1Ym5ldElkOiBzdWJuZXQuc3VibmV0SWRcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgbWFuaWZlc3REZXBsb3ltZW50OiBNYW5pZmVzdERlcGxveW1lbnQgPSB7XG4gICAgICAgICAgbmFtZTogXCJFbmlDdXN0b21Db25maWdcIiArIHN1Ym5ldCxcbiAgICAgICAgICBuYW1lc3BhY2U6IHRoaXMuY29yZUFkZE9uUHJvcHMubmFtZXNwYWNlISxcbiAgICAgICAgICBtYW5pZmVzdCxcbiAgICAgICAgICB2YWx1ZXMsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGt1YmVjdGxQcm92aWRlciA9IG5ldyBLdWJlY3RsUHJvdmlkZXIoY2x1c3RlckluZm8pO1xuICAgICAgICBrdWJlY3RsUHJvdmlkZXIuYWRkTWFuaWZlc3QobWFuaWZlc3REZXBsb3ltZW50KTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgYWRkT25Qcm9taXNlID0gc3VwZXIuZGVwbG95KGNsdXN0ZXJJbmZvKTtcbiAgICByZXR1cm4gYWRkT25Qcm9taXNlO1xuICB9XG5cbiAgLyoqXG4gICAqIE92ZXJyaWRlcyB0aGUgY29yZSBtZXRob2QgdG8gcHJvdmlkZSBtYW5hZ2VkIHBvbGljaWVzLlxuICAgKiBAcGFyYW0gX2NsdXN0ZXJJbmZvIFxuICAgKiBAcmV0dXJucyBcbiAgICovXG4gIHByb3ZpZGVNYW5hZ2VkUG9saWNpZXMoX2NsdXN0ZXJJbmZvOiBDbHVzdGVySW5mbyk6IGlhbS5JTWFuYWdlZFBvbGljeVtdIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy52cGNDbmlBZGRPblByb3BzLnNlcnZpY2VBY2NvdW50UG9saWNpZXM7XG4gIH1cblxuICAvKipcbiAgICogT3ZlcnJpZGVzIHRoZSBjb3JlIGFkZG9uIG1ldGhvZCBpbiBvcmRlciB0byByZXBsYWNlIHRoZSBTQSBpZiBleGlzdHMgKHdoaWNoIGlzIHRoZSBjYXNlIGZvciBhd3Mtbm9kZSkuXG4gICAqIEBwYXJhbSBjbHVzdGVySW5mbyBcbiAgICogQHBhcmFtIHNhTmFtZXNwYWNlIFxuICAgKiBAcGFyYW0gcG9saWNpZXMgXG4gICAqIEByZXR1cm5zIFxuICAgKi9cbiAgY3JlYXRlU2VydmljZUFjY291bnQoY2x1c3RlckluZm86IENsdXN0ZXJJbmZvLCBzYU5hbWVzcGFjZTogc3RyaW5nLCBwb2xpY2llczogaWFtLklNYW5hZ2VkUG9saWN5W10pOiBla3MuU2VydmljZUFjY291bnQge1xuICAgICAgY29uc3Qgc2EgPSBuZXcgUmVwbGFjZVNlcnZpY2VBY2NvdW50KGNsdXN0ZXJJbmZvLmNsdXN0ZXIsIGAke3RoaXMuY29yZUFkZE9uUHJvcHMuc2FOYW1lfS1zYWAsIHtcbiAgICAgICAgY2x1c3RlcjogY2x1c3RlckluZm8uY2x1c3RlcixcbiAgICAgICAgbmFtZTogdGhpcy5jb3JlQWRkT25Qcm9wcy5zYU5hbWUsXG4gICAgICAgIG5hbWVzcGFjZTogc2FOYW1lc3BhY2VcbiAgICAgIH0pO1xuXG4gICAgICBwb2xpY2llcy5mb3JFYWNoKHAgPT4gc2Eucm9sZS5hZGRNYW5hZ2VkUG9saWN5KHApKTtcbiAgICAgIHJldHVybiBzYSBhcyBhbnkgYXMgZWtzLlNlcnZpY2VBY2NvdW50O1xuICB9XG59XG5cbmZ1bmN0aW9uIHBvcHVsYXRlVnBjQ25pQ29uZmlndXJhdGlvblZhbHVlcyhwcm9wcz86IFZwY0NuaUFkZE9uUHJvcHMpOiBWYWx1ZXMge1xuICBpZiAocHJvcHMgPT09IG51bGwpIHtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICBjb25zdCByZXN1bHQ6IFZhbHVlcyA9IHtcbiAgICBlbnY6IHtcbiAgICAgIEFXU19FQzJfRU5EUE9JTlQ6IHByb3BzPy5hd3NFYzJFbmRwb2ludCxcbiAgICAgIEFERElUSU9OQUxfRU5JX1RBR1M6IHByb3BzPy5hZGRpdGlvbmFsRW5pVGFncyxcbiAgICAgIEFOTk9UQVRFX1BPRF9JUDogcHJvcHM/LmFubm90YXRlUG9kSXAsXG4gICAgICBBV1NfRVhURVJOQUxfU0VSVklDRV9DSURSOiBwcm9wcz8uYXdzRXh0ZXJuYWxTZXJ2aWNlQ2lkcnMsXG4gICAgICBBV1NfTUFOQUdFX0VOSVNfTk9OX1NDSEVEVUxBQkxFOiBwcm9wcz8uYXdzTWFuYWdlRW5pc05vblNjaGVkdWxhYmxlLFxuICAgICAgQVdTX1ZQQ19DTklfTk9ERV9QT1JUX1NVUFBPUlQ6IHByb3BzPy5hd3NWcGNDbmlOb2RlUG9ydFN1cHBvcnQsXG4gICAgICBBV1NfVlBDX0VOSV9NVFU6IHByb3BzPy5hd3NWcGNFbmlNdHUsXG4gICAgICBBV1NfVlBDX0s4U19DTklfQ1VTVE9NX05FVFdPUktfQ0ZHOiBwcm9wcz8uYXdzVnBjSzhzQ25pQ3VzdG9tTmV0d29ya0NmZyxcbiAgICAgIEFXU19WUENfSzhTX0NOSV9FWENMVURFX1NOQVRfQ0lEUlM6IHByb3BzPy5hd3NWcGNLOHNFeGNsdWRlU25hdENpZHJzLFxuICAgICAgRU5JX0NPTkZJR19MQUJFTF9ERUY6IHByb3BzPy5lbmlDb25maWdMYWJlbERlZixcbiAgICAgIEVOSV9DT05GSUdfQU5OT1RBVElPTl9ERUY6IHByb3BzPy5lbmlDb25maWdBbm5vdGF0aW9uRGVmLFxuICAgICAgQVdTX1ZQQ19LOFNfQ05JX0VYVEVSTkFMU05BVDogcHJvcHM/LmF3c1ZwY0s4c0NuaUV4dGVybmFsU25hdCxcbiAgICAgIEFXU19WUENfSzhTX0NOSV9MT0dMRVZFTDogcHJvcHM/LmF3c1ZwY0s4c0NuaUxvZ0xldmVsLFxuICAgICAgQVdTX1ZQQ19LOFNfQ05JX0xPR19GSUxFOiBwcm9wcz8uYXdzVnBjSzhzQ25pTG9nRmlsZSxcbiAgICAgIEFXU19WUENfSzhTX0NOSV9SQU5ET01JWkVTTkFUOiBwcm9wcz8uYXdzVnBjSzhzQ25pUmFuZG9taXplU25hdCxcbiAgICAgIEFXU19WUENfSzhTX0NOSV9WRVRIUFJFRklYOiBwcm9wcz8uYXdzVnBjSzhzQ25pVmV0aFByZWZpeCxcbiAgICAgIEFXU19WUENfSzhTX1BMVUdJTl9MT0dfRklMRTogcHJvcHM/LmF3c1ZwY0s4c1BsdWdpbkxvZ0ZpbGUsXG4gICAgICBBV1NfVlBDX0s4U19QTFVHSU5fTE9HX0xFVkVMOiBwcm9wcz8uYXdzVnBjSzhzUGx1Z2luTG9nTGV2ZWwsXG4gICAgICBDTFVTVEVSX0VORFBPSU5UOiBwcm9wcz8uY2x1c3RlckVuZHBvaW50LFxuICAgICAgRElTQUJMRV9MRUFLRURfRU5JX0NMRUFOVVA6IHByb3BzPy5kaXNhYmxlTGVha2VkRW5pQ2xlYW51cCxcbiAgICAgIERJU0FCTEVfSU5UUk9TUEVDVElPTjogcHJvcHM/LmRpc2FibGVJbnRyb3NwZWN0aW9uLFxuICAgICAgRElTQUJMRV9NRVRSSUNTOiBwcm9wcz8uZGlzYWJsZU1ldHJpY3MsXG4gICAgICBESVNBQkxFX05FVFdPUktfUkVTT1VSQ0VfUFJPVklTSU9OSU5HOiBwcm9wcz8uZGlzYWJsZW5ldHdvcmtSZXNvdXJjZVByb3Zpc2lvbmluZyxcbiAgICAgIERJU0FCTEVfVENQX0VBUkxZX0RFTVVYOiBwcm9wcz8uZGlzYWJsZVRjcEVhcmx5RGVtdXgsXG4gICAgICBFTkFCTEVfQkFORFdJRFRIX1BMVUdJTjogcHJvcHM/LmVuYWJsZUJhbmR3aWR0aFBsdWdpbixcbiAgICAgIEVOQUJMRV9ORlRBQkxFUzogcHJvcHM/LmVuYWJsZU5mdGFibGVzLFxuICAgICAgRU5BQkxFX1BPRF9FTkk6IHByb3BzPy5lbmFibGVQb2RFbmksXG4gICAgICBFTkFCTEVfUFJFRklYX0RFTEVHQVRJT046IHByb3BzPy5lbmFibGVQcmVmaXhEZWxlZ2F0aW9uLFxuICAgICAgRU5BQkxFX1Y2X0VHUkVTUzogcHJvcHM/LmVuYWJsZVY2RWdyZXNzLFxuICAgICAgSU5UUk9TUEVDVElPTl9CSU5EX0FERFJFU1M6IHByb3BzPy5pbnRyb3NwZWN0aW9uQmluZEFkZHJlc3MsXG4gICAgICBNQVhfRU5JOiBwcm9wcz8ubWF4RW5pLFxuICAgICAgTUlOSU1VTV9JUF9UQVJHRVQ6IHByb3BzPy5taW5pbXVtSXBUYXJnZXQsXG4gICAgICBQT0RfU0VDVVJJVFlfR1JPVVBfRU5GT1JDSU5HX01PREU6IHByb3BzPy5wb2RTZWN1cml0eUdyb3VwRW5mb3JjaW5nTW9kZSxcbiAgICAgIFdBUk1fRU5JX1RBUkdFVDogcHJvcHM/Lndhcm1FbmlUYXJnZXQsXG4gICAgICBXQVJNX0lQX1RBUkdFVDogcHJvcHM/Lndhcm1JcFRhcmdldCxcbiAgICAgIFdBUk1fUFJFRklYX1RBUkdFVDogcHJvcHM/Lndhcm1QcmVmaXhUYXJnZXRcbiAgICB9XG4gIH07XG5cbiAgLy8gY2xlYW4gdXAgYWxsIHVuZGVmaW5lZFxuICBjb25zdCB2YWx1ZXMgPSByZXN1bHQuZW52O1xuICBPYmplY3Qua2V5cyh2YWx1ZXMpLmZvckVhY2goa2V5ID0+IHZhbHVlc1trZXldID09PSB1bmRlZmluZWQgPyBkZWxldGUgdmFsdWVzW2tleV0gOiB7fSk7XG4gIE9iamVjdC5rZXlzKHZhbHVlcykuZm9yRWFjaChrZXkgPT4gdmFsdWVzW2tleV0gPSB0eXBlb2YgdmFsdWVzW2tleV0gIT09ICdzdHJpbmcnID8gIEpTT04uc3RyaW5naWZ5KHZhbHVlc1trZXldKTp2YWx1ZXNba2V5XSk7XG4gXG4gIHJldHVybiByZXN1bHQ7XG59Il19