"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.deployBeforeCapacity = exports.tagAsg = exports.setupClusterLogging = void 0;
const custom_resources_1 = require("aws-cdk-lib/custom-resources");
const customResource = require("aws-cdk-lib/custom-resources");
// Available Control Plane logging types
const CONTROL_PLANE_LOG_TYPES = ['api', 'audit', 'authenticator', 'controllerManager', 'scheduler'];
// Enables logs for the cluster.
function setupClusterLogging(stack, cluster, enableLogTypes) {
    if (!enableLogTypes.every(val => CONTROL_PLANE_LOG_TYPES.includes(val))) {
        throw new Error('You have included an invalid Control Plane Log Type.');
    }
    let disableLogTypes = CONTROL_PLANE_LOG_TYPES.filter(item => enableLogTypes.indexOf(item) < 0);
    new custom_resources_1.AwsCustomResource(stack, "ClusterLogsEnabler", {
        policy: custom_resources_1.AwsCustomResourcePolicy.fromSdkCalls({
            resources: [`${cluster.clusterArn}/update-config`],
        }),
        onCreate: {
            physicalResourceId: { id: `${cluster.clusterArn}/LogsEnabler` },
            service: "EKS",
            action: "updateClusterConfig",
            region: stack.region,
            parameters: {
                name: cluster.clusterName,
                logging: {
                    clusterLogging: [
                        {
                            enabled: true,
                            types: enableLogTypes,
                        },
                    ],
                },
            },
        },
        onDelete: {
            physicalResourceId: { id: `${cluster.clusterArn}/LogsEnabler` },
            service: "EKS",
            action: "updateClusterConfig",
            region: stack.region,
            parameters: {
                name: cluster.clusterName,
                logging: {
                    clusterLogging: [
                        {
                            enabled: false,
                            types: CONTROL_PLANE_LOG_TYPES,
                        },
                    ],
                },
            },
        },
        onUpdate: {
            physicalResourceId: { id: `${cluster.clusterArn}/LogsEnabler` },
            service: "EKS",
            action: "updateClusterConfig",
            region: stack.region,
            parameters: {
                name: cluster.clusterName,
                logging: {
                    clusterLogging: [
                        {
                            enabled: true,
                            types: enableLogTypes,
                        },
                        {
                            enabled: false,
                            types: disableLogTypes,
                        },
                    ],
                },
            },
        },
    });
}
exports.setupClusterLogging = setupClusterLogging;
/**
 * Creates the node termination tag for the ASG
 * @param scope
 * @param autoScalingGroup
 */
function tagAsg(scope, autoScalingGroup, tags) {
    let tagList = [];
    tags.forEach((tag) => {
        tagList.push({
            Key: tag.Key,
            Value: tag.Value,
            PropagateAtLaunch: true,
            ResourceId: autoScalingGroup,
            ResourceType: 'auto-scaling-group'
        });
    });
    const callProps = {
        service: 'AutoScaling',
        action: 'createOrUpdateTags',
        parameters: {
            Tags: tagList
        },
        physicalResourceId: customResource.PhysicalResourceId.of(`${autoScalingGroup}-asg-tag`)
    };
    new customResource.AwsCustomResource(scope, 'asg-tag', {
        onCreate: callProps,
        onUpdate: callProps,
        policy: customResource.AwsCustomResourcePolicy.fromSdkCalls({
            resources: customResource.AwsCustomResourcePolicy.ANY_RESOURCE
        })
    });
}
exports.tagAsg = tagAsg;
/**
 * Makes the provided construct run before any capacity (worker nodes) is provisioned on the cluster.
 * Useful for control plane add-ons, such as VPC-CNI that must be provisioned before EC2 (or Fargate) capacity is added.
 * @param construct identifies construct (such as core add-on) that should be provisioned before capacity
 * @param clusterInfo cluster provisioning context
 */
function deployBeforeCapacity(construct, clusterInfo) {
    var _a, _b, _c;
    let allCapacity = [];
    allCapacity = allCapacity.concat((_a = clusterInfo.nodeGroups) !== null && _a !== void 0 ? _a : [])
        .concat((_b = clusterInfo.autoscalingGroups) !== null && _b !== void 0 ? _b : [])
        .concat((_c = clusterInfo.fargateProfiles) !== null && _c !== void 0 ? _c : []);
    allCapacity.forEach(v => v.node.addDependency(construct));
}
exports.deployBeforeCapacity = deployBeforeCapacity;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2x1c3Rlci11dGlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi91dGlscy9jbHVzdGVyLXV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUVBLG1FQUEwRjtBQUUxRiwrREFBK0Q7QUFHL0Qsd0NBQXdDO0FBQ3hDLE1BQU0sdUJBQXVCLEdBQUcsQ0FBQyxLQUFLLEVBQUMsT0FBTyxFQUFDLGVBQWUsRUFBQyxtQkFBbUIsRUFBQyxXQUFXLENBQUMsQ0FBQztBQUVoRyxnQ0FBZ0M7QUFDaEMsU0FBZ0IsbUJBQW1CLENBQUMsS0FBWSxFQUFFLE9BQXFCLEVBQUUsY0FBd0I7SUFDaEcsSUFBRyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBQztRQUN0RSxNQUFNLElBQUksS0FBSyxDQUFDLHNEQUFzRCxDQUFDLENBQUM7S0FDeEU7SUFDRCxJQUFJLGVBQWUsR0FBRyx1QkFBdUIsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBRS9GLElBQUksb0NBQWlCLENBQUMsS0FBSyxFQUFFLG9CQUFvQixFQUFFO1FBQ2xELE1BQU0sRUFBRSwwQ0FBdUIsQ0FBQyxZQUFZLENBQUM7WUFDNUMsU0FBUyxFQUFFLENBQUMsR0FBRyxPQUFPLENBQUMsVUFBVSxnQkFBZ0IsQ0FBQztTQUNsRCxDQUFDO1FBRUYsUUFBUSxFQUFFO1lBQ1Qsa0JBQWtCLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FBRyxPQUFPLENBQUMsVUFBVSxjQUFjLEVBQUU7WUFDL0QsT0FBTyxFQUFFLEtBQUs7WUFDZCxNQUFNLEVBQUUscUJBQXFCO1lBQzdCLE1BQU0sRUFBRSxLQUFLLENBQUMsTUFBTTtZQUNwQixVQUFVLEVBQUU7Z0JBQ1gsSUFBSSxF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Q0FBQztTQUMzQyxNQUFNLENBQUMsTUFBQSxXQUFXLENBQUMsZUFBZSxtQ0FBSSxFQUFFLENBQUMsQ0FBQztJQUMvQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztBQUM5RCxDQUFDO0FBTkQsb0RBTUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBla3MgZnJvbSBcImF3cy1jZGstbGliL2F3cy1la3NcIjtcbmltcG9ydCB7IFN0YWNrIH0gZnJvbSBcImF3cy1jZGstbGliXCI7XG5pbXBvcnQgeyBBd3NDdXN0b21SZXNvdXJjZSwgQXdzQ3VzdG9tUmVzb3VyY2VQb2xpY3kgfSBmcm9tIFwiYXdzLWNkay1saWIvY3VzdG9tLXJlc291cmNlc1wiO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcbmltcG9ydCAqIGFzIGN1c3RvbVJlc291cmNlIGZyb20gJ2F3cy1jZGstbGliL2N1c3RvbS1yZXNvdXJjZXMnO1xuaW1wb3J0IHsgQ2x1c3RlckluZm8gfSBmcm9tIFwiLi4vc3BpXCI7XG5cbi8vIEF2YWlsYWJsZSBDb250cm9sIFBsYW5lIGxvZ2dpbmcgdHlwZXNcbmNvbnN0IENPTlRST0xfUExBTkVfTE9HX1RZUEVTID0gWydhcGknLCdhdWRpdCcsJ2F1dGhlbnRpY2F0b3InLCdjb250cm9sbGVyTWFuYWdlcicsJ3NjaGVkdWxlciddO1xuXG4vLyBFbmFibGVzIGxvZ3MgZm9yIHRoZSBjbHVzdGVyLlxuZXhwb3J0IGZ1bmN0aW9uIHNldHVwQ2x1c3RlckxvZ2dpbmcoc3RhY2s6IFN0YWNrLCBjbHVzdGVyOiBla3MuSUNsdXN0ZXIsIGVuYWJsZUxvZ1R5cGVzOiBzdHJpbmdbXSk6IHZvaWQge1xuXHRpZighZW5hYmxlTG9nVHlwZXMuZXZlcnkodmFsID0+IENPTlRST0xfUExBTkVfTE9HX1RZUEVTLmluY2x1ZGVzKHZhbCkpKXtcblx0XHR0aHJvdyBuZXcgRXJyb3IoJ1lvdSBoYXZlIGluY2x1ZGVkIGFuIGludmFsaWQgQ29udHJvbCBQbGFuZSBMb2cgVHlwZS4nKTtcblx0fVxuXHRsZXQgZGlzYWJsZUxvZ1R5cGVzID0gQ09OVFJPTF9QTEFORV9MT0dfVFlQRVMuZmlsdGVyKGl0ZW0gPT4gZW5hYmxlTG9nVHlwZXMuaW5kZXhPZihpdGVtKSA8IDApO1xuXG5cdG5ldyBBd3NDdXN0b21SZXNvdXJjZShzdGFjaywgXCJDbHVzdGVyTG9nc0VuYWJsZXJcIiwge1xuXHRcdHBvbGljeTogQXdzQ3VzdG9tUmVzb3VyY2VQb2xpY3kuZnJvbVNka0NhbGxzKHtcblx0XHRcdHJlc291cmNlczogW2Ake2NsdXN0ZXIuY2x1c3RlckFybn0vdXBkYXRlLWNvbmZpZ2BdLFxuXHRcdH0pLFxuXG5cdFx0b25DcmVhdGU6IHtcblx0XHRcdHBoeXNpY2FsUmVzb3VyY2VJZDogeyBpZDogYCR7Y2x1c3Rlci5jbHVzdGVyQXJufS9Mb2dzRW5hYmxlcmAgfSxcblx0XHRcdHNlcnZpY2U6IFwiRUtTXCIsXG5cdFx0XHRhY3Rpb246IFwidXBkYXRlQ2x1c3RlckNvbmZpZ1wiLFxuXHRcdFx0cmVnaW9uOiBzdGFjay5yZWdpb24sXG5cdFx0XHRwYXJhbWV0ZXJzOiB7XG5cdFx0XHRcdG5hbWU6IGNsdXN0ZXIuY2x1c3Rlck5hbWUsXG5cdFx0XHRcdGxvZ2dpbmc6IHtcblx0XHRcdFx0XHRjbHVzdGVyTG9nZ2luZzogW1xuXHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRlbmFibGVkOiB0cnVlLFxuXHRcdFx0XHRcdFx0XHR0eXBlczogZW5hYmxlTG9nVHlwZXMsXG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdF0sXG5cdFx0XHRcdH0sXG5cdFx0XHR9LFxuXHRcdH0sXG5cdFx0b25EZWxldGU6IHtcblx0XHRcdHBoeXNpY2FsUmVzb3VyY2VJZDogeyBpZDogYCR7Y2x1c3Rlci5jbHVzdGVyQXJufS9Mb2dzRW5hYmxlcmAgfSxcblx0XHRcdHNlcnZpY2U6IFwiRUtTXCIsXG5cdFx0XHRhY3Rpb246IFwidXBkYXRlQ2x1c3RlckNvbmZpZ1wiLFxuXHRcdFx0cmVnaW9uOiBzdGFjay5yZWdpb24sXG5cdFx0XHRwYXJhbWV0ZXJzOiB7XG5cdFx0XHRcdG5hbWU6IGNsdXN0ZXIuY2x1c3Rlck5hbWUsXG5cdFx0XHRcdGxvZ2dpbmc6IHtcblx0XHRcdFx0XHRjbHVzdGVyTG9nZ2luZzogW1xuXHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRlbmFibGVkOiBmYWxzZSxcblx0XHRcdFx0XHRcdFx0dHlwZXM6IENPTlRST0xfUExBTkVfTE9HX1RZUEVTLFxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRdLFxuXHRcdFx0XHR9LFxuXHRcdFx0fSxcblx0XHR9LFxuXHRcdG9uVXBkYXRlOiB7XG5cdFx0XHRwaHlzaWNhbFJlc291cmNlSWQ6IHsgaWQ6IGAke2NsdXN0ZXIuY2x1c3RlckFybn0vTG9nc0VuYWJsZXJgIH0sXG5cdFx0XHRzZXJ2aWNlOiBcIkVLU1wiLFxuXHRcdFx0YWN0aW9uOiBcInVwZGF0ZUNsdXN0ZXJDb25maWdcIixcblx0XHRcdHJlZ2lvbjogc3RhY2sucmVnaW9uLFxuXHRcdFx0cGFyYW1ldGVyczoge1xuXHRcdFx0XHRuYW1lOiBjbHVzdGVyLmNsdXN0ZXJOYW1lLFxuXHRcdFx0XHRsb2dnaW5nOiB7XG5cdFx0XHRcdFx0Y2x1c3RlckxvZ2dpbmc6IFtcblx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0ZW5hYmxlZDogdHJ1ZSxcblx0XHRcdFx0XHRcdFx0dHlwZXM6IGVuYWJsZUxvZ1R5cGVzLFxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0ZW5hYmxlZDogZmFsc2UsXG5cdFx0XHRcdFx0XHRcdHR5cGVzOiBkaXNhYmxlTG9nVHlwZXMsXG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdF0sXG5cdFx0XHRcdH0sXG5cdFx0XHR9LFxuXHRcdH0sXG5cdH0pO1xufVxuXG5pbnRlcmZhY2UgVGFnIHtcbiAgS2V5OiBzdHJpbmc7XG4gIFZhbHVlOiBzdHJpbmc7XG59XG5cbi8qKlxuICogQ3JlYXRlcyB0aGUgbm9kZSB0ZXJtaW5hdGlvbiB0YWcgZm9yIHRoZSBBU0dcbiAqIEBwYXJhbSBzY29wZVxuICogQHBhcmFtIGF1dG9TY2FsaW5nR3JvdXAgXG4gKi9cbiBleHBvcnQgZnVuY3Rpb24gdGFnQXNnKHNjb3BlOiBDb25zdHJ1Y3QsIGF1dG9TY2FsaW5nR3JvdXA6IHN0cmluZywgdGFnczogVGFnW10pOiB2b2lkIHtcbiAgbGV0IHRhZ0xpc3Q6IHtcbiAgICBLZXk6IHN0cmluZztcbiAgICBWYWx1ZTogc3RyaW5nO1xuICAgIFByb3BhZ2F0ZUF0TGF1bmNoOiBib29sZWFuO1xuICAgIFJlc291cmNlSWQ6IHN0cmluZztcbiAgICBSZXNvdXJjZVR5cGU6IHN0cmluZztcbiAgfVtdID0gW107XG5cbiAgdGFncy5mb3JFYWNoKCh0YWcpID0+IHtcbiAgICB0YWdMaXN0LnB1c2goe1xuICAgICAgS2V5OiB0YWcuS2V5LFxuICAgICAgVmFsdWU6IHRhZy5WYWx1ZSxcbiAgICAgIFByb3BhZ2F0ZUF0TGF1bmNoIDogdHJ1ZSxcbiAgICAgIFJlc291cmNlSWQ6IGF1dG9TY2FsaW5nR3JvdXAsXG4gICAgICBSZXNvdXJjZVR5cGU6ICdhdXRvLXNjYWxpbmctZ3JvdXAnXG4gICAgfSk7XG4gIH0pO1xuXG4gIGNvbnN0IGNhbGxQcm9wczogY3VzdG9tUmVzb3VyY2UuQXdzU2RrQ2FsbCA9IHtcbiAgICBzZXJ2aWNlOiAnQXV0b1NjYWxpbmcnLFxuICAgIGFjdGlvbjogJ2NyZWF0ZU9yVXBkYXRlVGFncycsXG4gICAgcGFyYW1ldGVyczoge1xuICAgICAgVGFnczogdGFnTGlzdFxuICAgIH0sXG4gICAgcGh5c2ljYWxSZXNvdXJjZUlkOiBjdXN0b21SZXNvdXJjZS5QaHlzaWNhbFJlc291cmNlSWQub2YoXG4gICAgICBgJHthdXRvU2NhbGluZ0dyb3VwfS1hc2ctdGFnYFxuICAgIClcbiAgfTtcblxuICBuZXcgY3VzdG9tUmVzb3VyY2UuQXdzQ3VzdG9tUmVzb3VyY2Uoc2NvcGUsICdhc2ctdGFnJywge1xuICAgIG9uQ3JlYXRlOiBjYWxsUHJvcHMsXG4gICAgb25VcGRhdGU6IGNhbGxQcm9wcyxcbiAgICBwb2xpY3k6IGN1c3RvbVJlc291cmNlLkF3c0N1c3RvbVJlc291cmNlUG9saWN5LmZyb21TZGtDYWxscyh7XG4gICAgICByZXNvdXJjZXM6IGN1c3RvbVJlc291cmNlLkF3c0N1c3RvbVJlc291cmNlUG9saWN5LkFOWV9SRVNPVVJDRVxuICAgIH0pXG4gIH0pO1xufVxuXG4vKipcbiAqIE1ha2VzIHRoZSBwcm92aWRlZCBjb25zdHJ1Y3QgcnVuIGJlZm9yZSBhbnkgY2FwYWNpdHkgKHdvcmtlciBub2RlcykgaXMgcHJvdmlzaW9uZWQgb24gdGhlIGNsdXN0ZXIuXG4gKiBVc2VmdWwgZm9yIGNvbnRyb2wgcGxhbmUgYWRkLW9ucywgc3VjaCBhcyBWUEMtQ05JIHRoYXQgbXVzdCBiZSBwcm92aXNpb25lZCBiZWZvcmUgRUMyIChvciBGYXJnYXRlKSBjYXBhY2l0eSBpcyBhZGRlZC5cbiAqIEBwYXJhbSBjb25zdHJ1Y3QgaWRlbnRpZmllcyBjb25zdHJ1Y3QgKHN1Y2ggYXMgY29yZSBhZGQtb24pIHRoYXQgc2hvdWxkIGJlIHByb3Zpc2lvbmVkIGJlZm9yZSBjYXBhY2l0eVxuICogQHBhcmFtIGNsdXN0ZXJJbmZvIGNsdXN0ZXIgcHJvdmlzaW9uaW5nIGNvbnRleHRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRlcGxveUJlZm9yZUNhcGFjaXR5KGNvbnN0cnVjdDogQ29uc3RydWN0LCBjbHVzdGVySW5mbzogQ2x1c3RlckluZm8pIHtcbiAgICBsZXQgYWxsQ2FwYWNpdHkgOiBDb25zdHJ1Y3RbXSAgPSBbXTtcbiAgICBhbGxDYXBhY2l0eSA9IGFsbENhcGFjaXR5LmNvbmNhdChjbHVzdGVySW5mby5ub2RlR3JvdXBzID8/IFtdKVxuICAgICAgICAuY29uY2F0KGNsdXN0ZXJJbmZvLmF1dG9zY2FsaW5nR3JvdXBzID8/IFtdKVxuICAgICAgICAuY29uY2F0KGNsdXN0ZXJJbmZvLmZhcmdhdGVQcm9maWxlcyA/PyBbXSk7XG4gICAgYWxsQ2FwYWNpdHkuZm9yRWFjaCh2ID0+IHYubm9kZS5hZGREZXBlbmRlbmN5KGNvbnN0cnVjdCkpO1xufSJdfQ==